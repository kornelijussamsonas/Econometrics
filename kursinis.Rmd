---
title: "Įskaitinių eismo įvykių Lietuvos keliuose analizė"
author: "Kornelijus Samsonas, Linas Šyvis"
output: pdf_document
---

#Nuskaitome duomenis
```{r, message=F, warning=F}
library(fpp)
rawdata<-read.csv2('tidy2015.csv', header = T)
agreguoti <- read.csv2("agreguoti2009-2015.csv", header = T)
gyventojai <- read.csv2("gyventojai.csv", header = T)
```

#Paliekame tik 5 didžiuosius miestus
```{r}
data <- rawdata[rawdata[,1] == "Vilniaus m. sav." | 
                     rawdata[,1] == "Kauno m. sav." | 
                     rawdata[,1] == "Klaipedos m. sav." | 
                     rawdata[,1] == "siauliu m. sav." | 
                     rawdata[,1] == "Panevezio m. sav.",]
miestai <- c("Vilniaus m. sav.", "Kauno m. sav.", "Klaipedos m. sav.", "siauliu m. sav.", "Panevezio m. sav.")
```

#Tvarkome blaivumo stulpeli(25)
```{r}
data[data[,25] == "Apsvaiges nuo narkotiniu, psichotropiniu ar kitu psichika veikianciu medziagu" | data[,25] == "Atsisake buti patikrintas",25] <- "Neblaivus"
data[data[,25] == "Neapsvaiges",25] <- "Blaivus"
data[,25] <- factor(data[,25])
```

#Pritaikome rodiklius 1000 gyv.
```{r}
kgyv <- gyventojai[,3]/1000
gyventojai <- cbind(gyventojai, kgyv)
```

#breziam kaska
```{r}
vln <- ts(agreguoti[agreguoti[,3] == miestai[1], 4], start=c(2009,1),  frequency = 12) / gyventojai[gyventojai[,1] == 2015 & gyventojai[,2] == miestai[1], 6]
kn <- ts(agreguoti[agreguoti[,3] == miestai[2], 4], start=c(2009,1),  frequency = 12) / gyventojai[gyventojai[,1] == 2015 & gyventojai[,2] == miestai[2], 6]
klp<- ts(agreguoti[agreguoti[,3] == miestai[3], 4], start=c(2009,1),  frequency = 12) / gyventojai[gyventojai[,1] == 2015 & gyventojai[,2] == miestai[3], 6]
sl<- ts(agreguoti[agreguoti[,3] == miestai[4], 4], start=c(2009,1),  frequency = 12) / gyventojai[gyventojai[,1] == 2015 & gyventojai[,2] == miestai[4], 6]
pnv<- ts(agreguoti[agreguoti[,3] == miestai[5], 4], start=c(2009,1),  frequency = 12)/ gyventojai[gyventojai[,1] == 2015 & gyventojai[,2] == miestai[5], 6]

plot(vln, ylim = c(0,0.3), lwd = 2, main = "Įvykių sk. 1000 gyv. didžiuosiuose miestuose", xlab = "Metai", ylab = "Įvykių sk. 1000 gyv.")
lines(kn, col = 2, lwd = 2)
lines(klp, col = 3, lwd = 2)
lines(sl, col = 4, lwd = 2)
lines(pnv, col = 6, lwd = 2)
legend("topleft", col = c(1,2,3,4,6), lty = 1, lwd = 2, legend = c("Vilnius", "Kaunas", "Klaipėda", "Šiauliai", "Panevėžys"), cex = 0.5)
```


#Skaičiuojam neblaivius
```{r}
neblaivus <- as.numeric(0)
blaivus <- as.numeric(0)
for(i in 1:5)
neblaivus[i] <- nrow(data[data[,25] == "Neblaivus" & data[,1] == miestai[i],]) / gyventojai[gyventojai[,1] == 2015 & gyventojai[,2] == miestai[i], 6]
rbind(miestai, round(neblaivus, digits = 3))

for(i in 1:5)
neblaivus[i] <- nrow(data[data[,25] == "Neblaivus" & data[,1] == miestai[i],])
for(i in 1:5)
blaivus[i] <- nrow(data[data[,25] == "Blaivus" & data[,1] == miestai[i],])

tab <-matrix(c(59, 434, 25, 269, 9, 138, 13, 90, 3, 93), nrow=5, byrow=T)
colnames(tab) <- c("taip", "ne")
rownames(tab) <- miestai
prop.test(tab)
```

Matome, kad p-value < 0.05, vadinasi H0 atmetam. Proporcijos statistiškai reikšmingai skiriasi. Patikrinkime tarp kurių miestų proporcijos yra statistiškai reikšmingai skirtingos.

```{r, warning = F}
pairwise.prop.test(tab, p.adjust.method = "none")
```

Proporcijos statistiškai reikšmingai skiriasi tarp Šiauliu m. sav. ir Panevėžio m. sav. ir tarp Vilniaus m. sav. ir Panevėžio m. sav.
Patikrinkime, ar Šiauliuose/Vilniuje įvykių dėl neblaivių vairuotojų kaltės yra statistiškai reikšmingai daugiau negu Panevėžyje.

```{r}
tab1 <-matrix(c(13, 90, 3, 93), nrow=2, byrow=T)
prop.test(tab1, alternative = "greater")

tab2 <-matrix(c(59, 434, 3, 93), nrow=2, byrow=T)
prop.test(tab2, alternative = "greater")
```

Paaiškėjo, kad Šiauliuose/Vilniuje įvykių dėl neblaivių vairuotojų kaltės yra statistiškai reikšmingai daugiau negu Panevėžyje.


#Tikrinam įvykių priklausomybę nuo amžiaus
```{r}
stazas <- cut(data[,24], breaks = c(0, 10, 20, 30, 40, 50, 60))
table(stazas)
```


#Forecastinam autoįvykius
```{r}
b <- ts(agreguoti[agreguoti[,3] == "Vilniaus m. sav.", 4], start=c(2009,1), frequency = 12)
plot(b)
```

```{r}
z <- auto.arima(b)
plot(forecast(z, h = 12))
#salinam sezona
liek <- ts(z$residuals,start=c(2009,1), frequency = 12)
stl <- stl(z$residuals, s.window="periodic")
ser <- liek - stl$time.series[,"seasonal"]
plot(ser)
```


Tikrinsime hipoteze ar Vilniaus mieste eismo ivykiu kaltininkai dazniau yra Vyrai nei moterys.

H0= V sk. = 

```{r}
Vilniusm <- rawdata[rawdata[,1] == "Vilniaus m. sav.",]
Kaunasm <- rawdata[rawdata[,1] == "Kauno m. sav.",]
Siauliaim <- rawdata[rawdata[,1] == "siauliu m. sav.",]
Klaipedam <- rawdata[rawdata[,1] == "Klaipedos m. sav.",]
Panevezysm <- rawdata[rawdata[,1] == "Panevezio m. sav.",]

```


### Kaltininku procentas miestuose (Vyrai/Moterys)

Kaltininku procentas Vilniaus mieste.

```{r}
vyruskV<-sum(na.omit(as.numeric(Vilniusm[,19]=="Vyras")))
moteruskV<-sum(na.omit(as.numeric(Vilniusm[,19]=="Moteris")))
visoV<-(vyruskV+moteruskV)
vyruprocV=vyruskV/visoV*100
moteruprocV=moteruskV/visoV*100
```

Kaltininku procentas Kauno mieste.

```{r}
vyruskK<-sum(na.omit(as.numeric(Kaunasm[,19]=="Vyras")))
moteruskK<-sum(na.omit(as.numeric(Kaunasm[,19]=="Moteris")))
visoK<-(vyruskK+moteruskK)
vyruprocK=vyruskK/visoK*100
moteruprocK=moteruskK/visoK*100
```

Kaltininku procentas Siauliu mieste.

```{r}
vyruskS<-sum(na.omit(as.numeric(Siauliaim[,19]=="Vyras")))
moteruskS<-sum(na.omit(as.numeric(Siauliaim[,19]=="Moteris")))
visoS<-(vyruskS+moteruskS)
vyruprocS=vyruskS/visoS*100
moteruprocS=moteruskS/visoS*100
```


Kaltininku procentas Klaipedos mieste.

```{r}
vyruskKl<-sum(na.omit(as.numeric(Klaipedam[,19]=="Vyras")))
moteruskKl<-sum(na.omit(as.numeric(Klaipedam[,19]=="Moteris")))
visoKl<-(vyruskKl+moteruskKl)
vyruprocKl=vyruskKl/visoKl*100
moteruprocKl=moteruskKl/visoKl*100
```

Kaltininku procentas Panevezio mieste.

```{r}
vyruskP<-sum(na.omit(as.numeric(Panevezysm[,19]=="Vyras")))
moteruskP<-sum(na.omit(as.numeric(Panevezysm[,19]=="Moteris")))
visoP<-(vyruskP+moteruskP)
vyruprocP=vyruskP/visoP*100
moteruprocP=moteruskP/visoP*100
```



Tikrinsime hipoteze ar Vilniaus mieste eismo ivykiu kaltininkai dazniau yra Vyrai nei moterys.

```{r}
Vilniusm <- rawdata[rawdata[,1] == "Vilniaus m. sav.",]
sum(Vilniusm[,"Lytis"]=="Vyras")
```


Palyginti zuvusiu/suzeistu menesinius vidurkius tarp laikotarpiu ir vietu.
Ar skiriasi ivykiu skaicius nakti ir diena?

